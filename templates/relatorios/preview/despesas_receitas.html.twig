{# Preview Despesas x Receitas #}
{% if filtros.visualizacao == 'sintetico' %}
    {# Visao Sintetica #}
    <div class="table-responsive">
        <table class="table table-striped table-hover table-sm">
            <thead class="table-dark">
                <tr>
                    <th>Categoria/Grupo</th>
                    <th class="text-end">Receitas</th>
                    <th class="text-end">%</th>
                    <th class="text-end">Despesas</th>
                    <th class="text-end">%</th>
                    <th class="text-end">Saldo</th>
                </tr>
            </thead>
            <tbody>
                {% if dados is iterable and dados|length > 0 %}
                    {% for chave, grupo in dados %}
                        <tr>
                            <td>{{ grupo.nome }}</td>
                            <td class="text-end text-success">R$ {{ grupo.receitas|number_format(2, ',', '.') }}</td>
                            <td class="text-end text-muted">{{ grupo.percentual_receitas }}%</td>
                            <td class="text-end text-danger">R$ {{ grupo.despesas|number_format(2, ',', '.') }}</td>
                            <td class="text-end text-muted">{{ grupo.percentual_despesas }}%</td>
                            <td class="text-end fw-bold {% if grupo.saldo >= 0 %}text-success{% else %}text-danger{% endif %}">
                                R$ {{ grupo.saldo|number_format(2, ',', '.') }}
                            </td>
                        </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="6" class="text-center text-muted py-4">
                            <i class="fas fa-info-circle fa-2x mb-2"></i><br>
                            Nenhum dado encontrado com os filtros selecionados.
                        </td>
                    </tr>
                {% endif %}
            </tbody>
            <tfoot class="table-primary">
                <tr>
                    <td class="text-end"><strong>TOTAIS:</strong></td>
                    <td class="text-end text-success"><strong>R$ {{ totais_receitas.total_geral|number_format(2, ',', '.') }}</strong></td>
                    <td class="text-end">100%</td>
                    <td class="text-end text-danger"><strong>R$ {{ totais_despesas.total_geral|number_format(2, ',', '.') }}</strong></td>
                    <td class="text-end">100%</td>
                    <td class="text-end fw-bold {% if saldo >= 0 %}text-success{% else %}text-danger{% endif %}">
                        <strong>R$ {{ saldo|number_format(2, ',', '.') }}</strong>
                    </td>
                </tr>
            </tfoot>
        </table>
    </div>
{% else %}
    {# Visao Analitica #}
    <div class="table-responsive">
        <table class="table table-striped table-hover table-sm">
            <thead class="table-dark">
                <tr>
                    <th>Data</th>
                    <th class="text-center">Tipo</th>
                    <th>Historico</th>
                    <th>Plano de Conta</th>
                    <th class="text-end">Receita</th>
                    <th class="text-end">Despesa</th>
                    <th class="text-end">Saldo Acum.</th>
                </tr>
            </thead>
            <tbody>
                {% if dados is iterable and dados|length > 0 %}
                    {% for item in dados %}
                        <tr>
                            <td>{{ item.data|date('d/m/Y') }}</td>
                            <td class="text-center">
                                {% if item.tipo == 'R' %}
                                    <span class="badge bg-success">R</span>
                                {% else %}
                                    <span class="badge bg-danger">D</span>
                                {% endif %}
                            </td>
                            <td>{{ item.historico|default('-')|length > 30 ? item.historico|default('-')|slice(0, 30) ~ '...' : item.historico|default('-') }}</td>
                            <td>{{ item.plano_conta }}</td>
                            <td class="text-end text-success">
                                {% if item.valor_receita > 0 %}R$ {{ item.valor_receita|number_format(2, ',', '.') }}{% endif %}
                            </td>
                            <td class="text-end text-danger">
                                {% if item.valor_despesa > 0 %}R$ {{ item.valor_despesa|number_format(2, ',', '.') }}{% endif %}
                            </td>
                            <td class="text-end fw-bold {% if item.saldo_acumulado >= 0 %}text-success{% else %}text-danger{% endif %}">
                                R$ {{ item.saldo_acumulado|number_format(2, ',', '.') }}
                            </td>
                        </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="7" class="text-center text-muted py-4">
                            <i class="fas fa-info-circle fa-2x mb-2"></i><br>
                            Nenhum dado encontrado com os filtros selecionados.
                        </td>
                    </tr>
                {% endif %}
            </tbody>
            <tfoot class="table-primary">
                <tr>
                    <td colspan="4" class="text-end"><strong>TOTAIS:</strong></td>
                    <td class="text-end text-success"><strong>R$ {{ totais_receitas.total_geral|number_format(2, ',', '.') }}</strong></td>
                    <td class="text-end text-danger"><strong>R$ {{ totais_despesas.total_geral|number_format(2, ',', '.') }}</strong></td>
                    <td class="text-end fw-bold {% if saldo >= 0 %}text-success{% else %}text-danger{% endif %}">
                        <strong>R$ {{ saldo|number_format(2, ',', '.') }}</strong>
                    </td>
                </tr>
            </tfoot>
        </table>
    </div>
{% endif %}

{# Resumo #}
<div class="row mt-4">
    <div class="col-md-4">
        <div class="card border-success">
            <div class="card-body text-center">
                <h6 class="text-muted">Total Receitas</h6>
                <h4 class="text-success">R$ {{ totais_receitas.total_geral|number_format(2, ',', '.') }}</h4>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card border-danger">
            <div class="card-body text-center">
                <h6 class="text-muted">Total Despesas</h6>
                <h4 class="text-danger">R$ {{ totais_despesas.total_geral|number_format(2, ',', '.') }}</h4>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card border-primary">
            <div class="card-body text-center">
                <h6 class="text-muted">Saldo Final</h6>
                <h4 class="{% if saldo >= 0 %}text-success{% else %}text-danger{% endif %}">
                    R$ {{ saldo|number_format(2, ',', '.') }}
                </h4>
            </div>
        </div>
    </div>
</div>
