{# Preview Inadimplentes #}
{% if totais.quantidade >= 500 %}
<div class="alert alert-warning py-2 mb-2">
    <i class="fas fa-exclamation-triangle"></i>
    Exibindo os primeiros <strong>500 registros</strong>. Use o PDF para relat√≥rio completo ou refine os filtros.
</div>
{% endif %}
<div class="table-responsive">
    <table class="table table-striped table-hover table-sm">
        <thead class="table-dark">
            <tr>
                <th>Inquilino</th>
                <th>Imovel</th>
                <th>Competencia</th>
                <th>Vencimento</th>
                <th class="text-center">Dias</th>
                <th class="text-end">Valor</th>
                <th class="text-end">Juros/Multa</th>
                <th class="text-end">Atualizado</th>
            </tr>
        </thead>
        <tbody>
            {% if dados is iterable and dados|length > 0 %}
                {% set primeiro = dados|first %}
                {% if primeiro.itens is defined %}
                    {# Dados agrupados #}
                    {% for grupo in dados %}
                        <tr class="table-secondary">
                            <td colspan="8"><strong>{{ grupo.nome }}</strong></td>
                        </tr>
                        {% for item in grupo.itens %}
                            <tr>
                                <td>{{ item.lancamento.inquilino.nome|default('-') }}</td>
                                <td>{{ item.lancamento.imovel.id|default('-') }}</td>
                                <td>{{ item.lancamento.competenciaFormatada|default('-') }}</td>
                                <td>{{ item.lancamento.dataVencimento|date('d/m/Y') }}</td>
                                <td class="text-center">
                                    <span class="badge bg-danger">{{ item.dias_atraso }}</span>
                                </td>
                                <td class="text-end">R$ {{ item.valor_original|number_format(2, ',', '.') }}</td>
                                <td class="text-end text-danger">R$ {{ (item.valor_juros + item.valor_multa)|number_format(2, ',', '.') }}</td>
                                <td class="text-end fw-bold">R$ {{ item.valor_atualizado|number_format(2, ',', '.') }}</td>
                            </tr>
                        {% endfor %}
                        <tr class="table-warning">
                            <td colspan="5" class="text-end"><strong>Subtotal {{ grupo.nome }}:</strong></td>
                            <td class="text-end">R$ {{ grupo.total_original|number_format(2, ',', '.') }}</td>
                            <td class="text-end">R$ {{ (grupo.total_juros + grupo.total_multa)|number_format(2, ',', '.') }}</td>
                            <td class="text-end fw-bold">R$ {{ grupo.total_atualizado|number_format(2, ',', '.') }}</td>
                        </tr>
                    {% endfor %}
                {% else %}
                    {# Dados nao agrupados #}
                    {% for item in dados %}
                        <tr>
                            <td>{{ item.lancamento.inquilino.nome|default('-') }}</td>
                            <td>{{ item.lancamento.imovel.id|default('-') }}</td>
                            <td>{{ item.lancamento.competenciaFormatada|default('-') }}</td>
                            <td>{{ item.lancamento.dataVencimento|date('d/m/Y') }}</td>
                            <td class="text-center">
                                <span class="badge bg-danger">{{ item.dias_atraso }}</span>
                            </td>
                            <td class="text-end">R$ {{ item.valor_original|number_format(2, ',', '.') }}</td>
                            <td class="text-end text-danger">R$ {{ (item.valor_juros + item.valor_multa)|number_format(2, ',', '.') }}</td>
                            <td class="text-end fw-bold">R$ {{ item.valor_atualizado|number_format(2, ',', '.') }}</td>
                        </tr>
                    {% endfor %}
                {% endif %}
            {% else %}
                <tr>
                    <td colspan="8" class="text-center text-muted py-4">
                        <i class="fas fa-check-circle fa-2x mb-2 text-success"></i><br>
                        Nenhum inadimplente encontrado com os filtros selecionados.
                    </td>
                </tr>
            {% endif %}
        </tbody>
        {% if totais.quantidade > 0 %}
        <tfoot class="table-primary">
            <tr>
                <td colspan="4" class="text-end"><strong>TOTAL GERAL:</strong></td>
                <td class="text-center"><strong>{{ totais.quantidade }}</strong></td>
                <td class="text-end"><strong>R$ {{ totais.total_original|number_format(2, ',', '.') }}</strong></td>
                <td class="text-end"><strong>R$ {{ (totais.total_juros + totais.total_multa)|number_format(2, ',', '.') }}</strong></td>
                <td class="text-end"><strong>R$ {{ totais.total_atualizado|number_format(2, ',', '.') }}</strong></td>
            </tr>
        </tfoot>
        {% endif %}
    </table>
</div>
