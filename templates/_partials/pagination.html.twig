{# Pagination partial
   Variables:
   - totalItems: int
   - currentPage: int
   - itemsPerPage: int
   - totalPages: int
   - search: string
   - routeName: string
   - routeParams: array (optional)
#}
{% set routeParams = routeParams ?? {} %}

<div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-3 mt-3">

    {# Left: total count + per-page selector #}
    <div class="d-flex align-items-center gap-2">
        <span class="text-muted small">
            <strong>{{ totalItems }}</strong> registro{{ totalItems != 1 ? 's' : '' }} encontrado{{ totalItems != 1 ? 's' : '' }}
        </span>
        <form method="GET" action="{{ path(routeName, routeParams) }}" class="d-inline">
            <input type="hidden" name="search" value="{{ search }}">
            <input type="hidden" name="page" value="1">
            <select name="perPage" class="form-select form-select-sm d-inline-block w-auto" onchange="this.form.submit()">
                {% for opt in [15, 30, 50, 100] %}
                    <option value="{{ opt }}" {% if itemsPerPage == opt %}selected{% endif %}>{{ opt }} por página</option>
                {% endfor %}
            </select>
        </form>
    </div>

    {# Center: search box #}
    <form method="GET" action="{{ path(routeName, routeParams) }}" class="d-flex gap-2">
        <input type="hidden" name="page" value="1">
        <input type="hidden" name="perPage" value="{{ itemsPerPage }}">
        <div class="input-group input-group-sm">
            <input type="text" name="search" value="{{ search }}" class="form-control" placeholder="Buscar..." style="min-width: 180px;">
            <button type="submit" class="btn btn-outline-secondary">
                <i class="fas fa-search"></i>
            </button>
            {% if search %}
                <a href="{{ path(routeName, routeParams|merge({'page': 1, 'perPage': itemsPerPage})) }}" class="btn btn-outline-danger" title="Limpar busca">
                    <i class="fas fa-times"></i>
                </a>
            {% endif %}
        </div>
    </form>

    {# Right: page navigation #}
    {% if totalPages > 1 %}
    <nav>
        <ul class="pagination pagination-sm mb-0">
            {# First #}
            <li class="page-item {% if currentPage == 1 %}disabled{% endif %}">
                <a class="page-link" href="{{ path(routeName, routeParams|merge({'page': 1, 'perPage': itemsPerPage, 'search': search})) }}" title="Primeira">
                    <i class="fas fa-angle-double-left"></i>
                </a>
            </li>
            {# Prev #}
            <li class="page-item {% if currentPage == 1 %}disabled{% endif %}">
                <a class="page-link" href="{{ path(routeName, routeParams|merge({'page': max(1, currentPage - 1), 'perPage': itemsPerPage, 'search': search})) }}" title="Anterior">
                    <i class="fas fa-angle-left"></i>
                </a>
            </li>

            {# Page numbers - show window of 5 around current #}
            {% set startPage = max(1, currentPage - 2) %}
            {% set endPage = min(totalPages, startPage + 4) %}
            {% set startPage = max(1, endPage - 4) %}

            {% if startPage > 1 %}
                <li class="page-item disabled"><span class="page-link">...</span></li>
            {% endif %}

            {% for p in startPage..endPage %}
                <li class="page-item {% if p == currentPage %}active{% endif %}">
                    <a class="page-link" href="{{ path(routeName, routeParams|merge({'page': p, 'perPage': itemsPerPage, 'search': search})) }}">{{ p }}</a>
                </li>
            {% endfor %}

            {% if endPage < totalPages %}
                <li class="page-item disabled"><span class="page-link">...</span></li>
            {% endif %}

            {# Next #}
            <li class="page-item {% if currentPage == totalPages %}disabled{% endif %}">
                <a class="page-link" href="{{ path(routeName, routeParams|merge({'page': min(totalPages, currentPage + 1), 'perPage': itemsPerPage, 'search': search})) }}" title="Próxima">
                    <i class="fas fa-angle-right"></i>
                </a>
            </li>
            {# Last #}
            <li class="page-item {% if currentPage == totalPages %}disabled{% endif %}">
                <a class="page-link" href="{{ path(routeName, routeParams|merge({'page': totalPages, 'perPage': itemsPerPage, 'search': search})) }}" title="Última">
                    <i class="fas fa-angle-double-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    {% endif %}

</div>
