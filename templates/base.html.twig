<!DOCTYPE html>
<html lang="pt" data-bs-theme="{% if pessoa is defined and pessoa is not null and pessoa.isThemeLight() %}light{% else %}dark{% endif %}">

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>
			{% block title %}Almasa
			{% endblock %}
		</title>

		<!-- Bootstrap CSS -->
		<link
		href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

		<!-- Bootstrap Icons -->
		<link
		rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">

		<!-- app.css -->
		<link
		rel="stylesheet" href="{{ asset('css/app.css') }}">

		<!-- Favicon usando Bootstrap Icons -->
		<link rel="icon" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/icons/bootstrap.svg" type="image/svg+xml">
	</head>

	<body
		class="d-flex flex-column min-vh-100">
		<!-- Navbar -->
		<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
			<div
				class="container-fluid d-flex align-items-center">
				<!-- Logotipo -->
				<a class="navbar-brand d-flex align-items-center" href="{{ path('app_dashboard') }}">
					<img src="{{ asset('images/almasa-logo.png') }}" alt="Almasa Imóveis" class="logo-almasa me-2">
					<span>Dashboard</span>
				</a>

				<div
					class="d-flex align-items-center ms-auto">
					<!-- Botão de alternância de tema -->
					<button id="toggle_theme" class="btn btn-light me-3">
						<i id="theme-icon" class="bi"></i>
					</button>

					{% if app.user %}
						<!-- Dropdown do Usuário -->
						<div class="dropdown">
							<button class="btn btn-light dropdown-toggle" type="button" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
								{{ app.user.email }}
							</button>
							<ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
								<li>
									<h6 class="dropdown-header">Editar conta</h6>
								</li>
								<li>
									<a class="dropdown-item" href="{{ path('app_profile') }}">Perfil</a>
								</li>
								<li><hr class="dropdown-divider"></li>
								<li>
									<a class="dropdown-item text-danger" href="{{ path('app_logout') }}">Logout</a>
								</li>
							</ul>
						</div>
					{% endif %}
				</div>
			</div>
		</nav>

		<!-- Conteúdo da Página -->
		<main class="container mt-4 flex-grow-1"> {% block content %}{% endblock %}
			</main>

			<!-- Footer -->
			<footer class="text-center p-3 bg-primary text-white mt-auto">
				&copy;
				{{ 'now'|date('Y') }}
				Almasa. Todos os direitos reservados.
			</footer>

			<!-- Bootstrap JS -->
			<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

			<!-- Script para alternar entre modo claro e escuro -->
			<script>
				document.addEventListener("DOMContentLoaded", function () {
const themeToggle = document.getElementById("toggle_theme");
const themeIcon = document.getElementById("theme-icon");
const htmlElement = document.documentElement;

// Verifica se já há um tema salvo no localStorage
let currentTheme = localStorage.getItem("theme") || "light";
htmlElement.setAttribute("data-bs-theme", currentTheme);
themeIcon.className = currentTheme === "dark" ? "bi bi-sun" : "bi bi-moon";

if (themeToggle) {
themeToggle.addEventListener("click", function () {
let newTheme = htmlElement.getAttribute("data-bs-theme") === "dark" ? "light" : "dark";
htmlElement.setAttribute("data-bs-theme", newTheme);
themeIcon.className = newTheme === "dark" ? "bi bi-sun" : "bi bi-moon";
localStorage.setItem("theme", newTheme);{% if app.user %}
// Apenas salva no banco se o usuário estiver logado
fetch("{{ path('toggle_theme') }}", {
method: "POST",
headers: {
"Content-Type": "application/json",
"X-Requested-With": "XMLHttpRequest"
},
body: JSON.stringify({})
}).then(response => response.json()).then(data => {
if (!data.success) {
console.error("Erro ao alternar tema:", data.error);
}
}).catch(error => console.error("Erro na requisição:", error));{% endif %}
});
}
});
			</script>
		</body>
	</html>
